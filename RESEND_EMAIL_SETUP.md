# Resend Email Integration - Setup Guide

## âœ… What's Been Implemented

### **1. Email API Endpoints (Vercel Serverless Functions)**

#### `/api/emails/send-order-confirmation.js`
- Sends beautiful HTML email after successful purchase
- Includes: customer name, guide title, order amount, order ID
- CTA button to access purchased guide

#### `/api/emails/send-affiliate-welcome.js`
- Sends welcome email when someone applies to affiliate program
- Includes: welcome message, referral ID, commission rate, next steps
- Mentions 48-hour approval timeline

---

### **2. Email Templates**

Both emails feature:
- âœ… **Hatche branding** - Gradient brown header with logo
- âœ… **Professional HTML design** - Responsive, works on all email clients
- âœ… **Sweet, welcoming messages**
- âœ… **Order/Application details** in highlighted boxes
- âœ… **Call-to-action buttons**
- âœ… **Footer** with contact info, address, Instagram link

---

### **3. Integration Points**

#### **Checkout Flow:**
`src/checkout.js` - Line 193-210
- Sends email AFTER order is created in database
- Before redirecting to PayFast
- Non-blocking (continues even if email fails)

#### **Affiliate Application:**
`src/affiliate.js` - Line 258-274
- Sends email AFTER application is saved to database
- Includes tier name and commission rate
- Non-blocking

---

## ğŸ”§ Environment Variables

### **Required in Vercel:**

Add these to your Vercel project dashboard:

```
RESEND_API_KEY=re_HKfxPoFT_JbLde2CSZ1Xvkm8sVMFikUod
FROM_EMAIL=hello@hatchepk.com
```

### **Steps:**
1. Go to Vercel Dashboard
2. Select your project
3. Go to Settings â†’ Environment Variables
4. Add both variables above
5. Select "All" environments (Production, Preview, Development)
6. Save and redeploy

---

## ğŸ“§ Email Templates Preview

### **Order Confirmation Email:**

**Subject:** ğŸ‰ Your Guide is Ready - Order #XXXXXXXX

**Content:**
- Gradient brown header with "HATCHE" logo
- "Thank You for Your Purchase!" heading
- Sweet message welcoming them to the community
- Order details box:
  - Guide title
  - Amount paid (PKR)
  - Order ID
- "Access Your Guide Now" button â†’ links to `/your-guides`
- Warm closing message
- Footer with contact info and address

---

### **Affiliate Welcome Email:**

**Subject:** ğŸŠ Welcome to Hatche Affiliate Program - Application Received

**Content:**
- Gradient brown header with "HATCHE Affiliate Program"
- "Welcome to the Hatche Family!" heading
- Personalized greeting with applicant's name
- Sweet message thanking them for applying
- Affiliate details box:
  - Referral ID (shows "Pending Approval" until approved)
  - Commission rate (5%, 15%, or 25%)
- Yellow "Under Review" notice (48-hour timeline)
- "What Happens Next?" section:
  1. Review process (48 hours)
  2. Approval email notification
  3. Start promoting with referral link
  4. Track earnings in dashboard
- Warm closing message
- Footer with contact info

---

## ğŸ¨ Design Features

### **Colors Used:**
- **Primary Brown**: #73160f (your brand color)
- **Gradient**: #73160f â†’ #8b1a13
- **Background**: #fdfcf1 (your site's beige)
- **Accent Yellow**: #fff3cd (for notices)
- **White**: #ffffff (email body)

### **Typography:**
- **Heading Font**: Georgia, serif (matches your site)
- **Body Font**: System fonts for email compatibility
- **Responsive**: Works on desktop, mobile, all email clients

### **Shadows & Borders:**
- Subtle shadows: `rgba(115, 22, 15, 0.1)`
- 3px red bar at footer
- Rounded corners: 12-16px

---

## ğŸ§ª Testing

### **Test Order Confirmation Email:**
1. Make a test purchase on your site
2. Check the customer's email inbox
3. Email should arrive within seconds

### **Test Affiliate Welcome Email:**
1. Submit an affiliate application
2. Check applicant's email inbox
3. Email should arrive immediately

### **If Emails Don't Send:**
- Check Vercel function logs for errors
- Verify `RESEND_API_KEY` is set correctly in Vercel
- Ensure `hello@hatchepk.com` is verified on Resend dashboard
- Check Resend dashboard for delivery status

---

## ğŸ“Š What Happens

### **Order Flow:**
```
Customer completes checkout
  â†“
Order saved to Supabase (pending)
  â†“
ğŸ“§ Email sent (order confirmation)
  â†“
Redirect to PayFast
  â†“
Payment processed
  â†“
Webhook updates order to "completed"
```

### **Affiliate Flow:**
```
User submits application
  â†“
Application saved to Supabase (pending)
  â†“
ğŸ“§ Email sent (welcome + under review notice)
  â†“
Admin approves (within 48 hours)
  â†“
ref_id generated by database trigger
  â†“
(Future: Send approval email with ref_id and dashboard link)
```

---

## ğŸš€ Next Steps (Optional Enhancements)

1. **Affiliate Approval Email**: Create another template for when affiliate is approved
2. **Password Reset Email**: For user authentication
3. **Receipt Email**: Attach PDF receipt to order confirmations
4. **Commission Notification**: Email affiliates when they earn a commission

---

## ğŸ› ï¸ Technical Details

### **Package Used:**
- `resend` - Official Resend SDK for Node.js
- Installed via: `npm install resend --save`

### **Email Sending Method:**
```javascript
const resend = new Resend(process.env.RESEND_API_KEY);

await resend.emails.send({
  from: 'hello@hatchepk.com',
  to: ['customer@example.com'],
  subject: 'Subject Line',
  html: '<html>...</html>'
});
```

### **Error Handling:**
- Non-blocking: If email fails, transaction continues
- Logs errors to console for debugging
- Returns success/failure response to frontend

---

## âœ… Verification Checklist

- [x] Resend package installed
- [x] API key added to `.env`
- [x] FROM email set (`hello@hatchepk.com`)
- [x] Order confirmation email template created
- [x] Affiliate welcome email template created
- [x] Integrated into checkout flow
- [x] Integrated into affiliate application flow
- [ ] API key added to Vercel dashboard
- [ ] Tested order confirmation email
- [ ] Tested affiliate welcome email

---

## ğŸ“ Important Notes

1. **Domain Verification**: `hatchepk.com` must be verified in your Resend dashboard
2. **FROM Email**: Must use `@hatchepk.com` domain (already verified)
3. **Rate Limits**: Resend free tier allows 100 emails/day, 3,000/month
4. **Non-Critical Failures**: Emails failing won't break the user flow

---

**Status:** âœ… READY TO USE

Once you add the environment variables to Vercel, emails will start sending automatically! ğŸ“§âœ¨

